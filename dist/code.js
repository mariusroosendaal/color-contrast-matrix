var k=Object.defineProperty;var M=(l,e,o)=>e in l?k(l,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):l[e]=o;var g=(l,e,o)=>M(l,typeof e!="symbol"?e+"":e,o);figma.showUI(__html__,{themeColors:!0,width:360,height:480});figma.loadFontAsync({family:"IBM Plex Mono",style:"Regular"});figma.loadFontAsync({family:"Inter",style:"Regular"});class F{constructor(e,o,a,n){g(this,"instance");g(this,"backgroundColor");g(this,"foregroundColor");g(this,"baseColor");this.instance=e,this.backgroundColor=o,this.foregroundColor=a,this.baseColor=n}async toHexValue(e,o){const a=e.resolveForConsumer(o);if(a.resolvedType==="COLOR"){const{r:n,g:t,b:i}=a.value,r=s=>Math.round(s*255).toString(16).padStart(2,"0");return`#${r(n)}${r(t)}${r(i)}`}return"#000000"}applyColors(e){const o=this.instance.fills;if(o&&o.length>0&&o[0].type==="SOLID"){const t=figma.variables.setBoundVariableForPaint(o[0],"color",this.backgroundColor.variable);this.instance.fills=[t]}const a=this.instance.findOne(t=>t.name==="text");if(a){const t=e?this.foregroundColor.name.replace("/"," "):this.foregroundColor.name.split("/")[1]||this.foregroundColor.name;a.characters=t.toLowerCase()}const n=a.fills;if(n&&n.length>0&&n[0].type==="SOLID")if(this.instance.name==="gridHeaderTile"){const t=this.backgroundColor.variable.resolveForConsumer(this.instance).value,i={color:{r:t.r,g:t.g,b:t.b},opacity:t.a},r=this.getBlendedColor(i,1,this.baseColor);this.applyTextColor(a,r);const s=this.instance.findOne(d=>d.name==="hex");s&&this.toHexValue(this.foregroundColor.variable,this.instance).then(d=>{s.characters=t.a<1?`${d} ${Math.round(t.a*100)}%`.toUpperCase():d.toUpperCase(),this.applyTextColor(s,r)})}else{const t=figma.variables.setBoundVariableForPaint(n[0],"color",this.foregroundColor.variable);a.fills=[t]}}applyTextColor(e,o){const a={r:0,g:0,b:0},n={r:1,g:1,b:1},t=this.getContrast({color:a,opacity:1},{color:o,opacity:1},this.baseColor),i=this.getContrast({color:n,opacity:1},{color:o,opacity:1},this.baseColor);let r=a;t<4.5&&i>=4.5?r=n:t>=i&&t>=4.5?r=a:i>t&&(r=n),e.fills=[{type:"SOLID",color:r}]}applyContrastLabel(){const e=this.instance.fills[0],a=this.instance.findOne(i=>i.name==="text").fills[0],n=this.getContrast(a,e,this.baseColor),t=this.instance.findOne(i=>i.name==="ratio");if(t&&t.type==="TEXT"){t.characters=n.toFixed(2)+":1";const i=this.getBlendedColor(e,1,this.baseColor);this.applyTextColor(t,i)}return n}getBlendedColor(e,o,a){const n=e.color,t=e.opacity!==void 0?e.opacity:1;return{r:n.r*t+a.r*(1-t),g:n.g*t+a.g*(1-t),b:n.b*t+a.b*(1-t)}}applyVariant(e){const o=this.instance.findOne(a=>a.name==="label");o&&o.setProperties({"Property 1":this.getContrastVariant(e)})}checkAndHideTile(){this.instance.fills=[],this.instance.findAll(o=>o!==this.instance).forEach(o=>o.visible=!1)}getRelativeLuminance(e,o,a){const n=t=>t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4);return .2126*n(e)+.7152*n(o)+.0722*n(a)}getContrast(e,o,a){const n=e.color,t=o.color,i=e.opacity!==void 0?e.opacity:1,r=o.opacity!==void 0?o.opacity:1,s={r:t.r*r+a.r*(1-r),g:t.g*r+a.g*(1-r),b:t.b*r+a.b*(1-r)},d={r:n.r*i+s.r*(1-i),g:n.g*i+s.g*(1-i),b:n.b*i+s.b*(1-i)},u=this.getRelativeLuminance(d.r,d.g,d.b),p=this.getRelativeLuminance(s.r,s.g,s.b),[m,v]=u>p?[u,p]:[p,u];return(m+.05)/(v+.05)}getContrastVariant(e){return e>=7?"aaa":e>=4.5?"aa":e>=3?"aa18":"dnp"}processTile(e){if(this.backgroundColor.variable.id===this.foregroundColor.variable.id){this.checkAndHideTile();return}const o=this.applyContrastLabel();this.applyVariant(o),(!e.aaa&&o>=7||!e.aa&&o>=4.5&&o<7||!e.aa18&&o>=3&&o<4.5||!e.dnp&&o<3)&&this.checkAndHideTile()}}class H{constructor(){g(this,"backgroundColors");g(this,"foregroundColors");g(this,"gridTileComponent");this.backgroundColors=[],this.foregroundColors=[]}async getColorVariables(){const e=await figma.variables.getLocalVariableCollectionsAsync(),o=[];for(const a of e)for(const n of a.variableIds){const t=await figma.variables.getVariableByIdAsync(n);t.resolvedType==="COLOR"&&o.push({name:t.name,collection:a.name,variable:t})}return o}groupVariablesByPrefix(e){const o={};return e.forEach(a=>{const[n]=a.name.split("/");o[n]||(o[n]=[]),o[n].push(a)}),o}createFrame(e,o,a,n,t,i){const r=figma.createFrame();return r.layoutMode=e,r.primaryAxisSizingMode="AUTO",r.counterAxisSizingMode="AUTO",r.itemSpacing=a,r.horizontalPadding=n,r.verticalPadding=t,r.name=o,r.fills=[{type:"SOLID",color:i}],r}async generateMatrix(e,o,a,n){if(!e.length||!o.length){figma.notify("Select at least one variable group to generate the matrix.",{error:!0}),figma.ui.postMessage({type:"generation-error",reason:"empty-selection"});return}const t=await this.getColorVariables(),i=this.groupVariablesByPrefix(t),s=(c=>({r:parseInt(c.slice(1,3),16)/255,g:parseInt(c.slice(3,5),16)/255,b:parseInt(c.slice(5,7),16)/255}))(n);this.backgroundColors=[],this.foregroundColors=[],e.forEach(c=>{i[c]&&this.backgroundColors.push(...i[c])}),o.forEach(c=>{i[c]&&this.foregroundColors.push(...i[c])});const d=e.length?e.join(", "):"background",u=o.length?o.join(", "):"text",p=a.useDistinct?`${d} Ã— ${u}`:d,m=await figma.importComponentByKeyAsync("d4136c7cdbfa21a9bc90421b055b2bd6f2260a54"),v=await figma.importComponentByKeyAsync("13d3d4c5a355847f9f56eaf96541e6fa8a29311d"),B=await figma.importComponentByKeyAsync("e0b50d04f34885e7b7dc13680776a1a62c307006"),w=await figma.importComponentByKeyAsync("f9ab15001530fa4cc6360b7f1742dc71f16a7add"),T=this.createFrame("VERTICAL",p.toLowerCase(),0,0,0,s),L=this.createFrame("VERTICAL","colors",1,1,1,s);if(B){const c=B.createInstance();c.layoutAlign="STRETCH";const f=c.findOne(O=>O.name==="title");f&&f.type==="TEXT"&&(f.characters=p.toLowerCase()),T.appendChild(c)}if(T.appendChild(L),w&&w.type==="COMPONENT"){const c=w,f=m,O=v;if(m&&m.type==="COMPONENT"){const C=O.createInstance(),h=this.createFrame("HORIZONTAL","header",1,0,0,s);h.appendChild(C);for(let b=0;b<this.foregroundColors.length;b++){const y=f.createInstance(),A=this.foregroundColors[b];new F(y,A,A,s).applyColors(a.fullName),h.appendChild(y)}L.appendChild(h)}for(let C=0;C<this.backgroundColors.length;C++){const h=this.createFrame("HORIZONTAL","row",1,0,0,s),b=f.createInstance(),y=this.backgroundColors[C];new F(b,y,y,s).applyColors(a.fullName),h.appendChild(b);for(let x=0;x<this.foregroundColors.length;x++){const P=c.createInstance(),R=new F(P,this.backgroundColors[C],this.foregroundColors[x],s);R.applyColors(a.fullName),R.processTile(a),h.appendChild(P)}L.appendChild(h)}const I=[];figma.currentPage.appendChild(T),I.push(T),figma.currentPage.selection=I,figma.viewport.scrollAndZoomIntoView(I),figma.closePlugin("Matrix generated successfully!")}else figma.closePlugin("Template components not found or not a valid component!")}}const V=new H;V.getColorVariables().then(l=>{const e=V.groupVariablesByPrefix(l);figma.ui.postMessage({groups:e})});figma.ui.onmessage=async l=>{if(l.type==="generate-grid"){const e=l.array.selectedBackgroundGroups??[],o=l.array.useDistinct?l.array.selectedForegroundGroups??[]:e;await V.generateMatrix(e,o,l.array,l.baseColorHex)}else l.type==="close"&&figma.closePlugin()};
